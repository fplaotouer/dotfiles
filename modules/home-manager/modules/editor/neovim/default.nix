{
  lib,
  config,
  pkgs,
  ...
}: {
  imports = [
    ./plugins
  ];

  programs.neovim = {
    package = pkgs.neovim-nightly;
    vimAlias = true;
    extraPackages = builtins.attrValues {
      inherit (pkgs) luajit shfmt;
    };
    extraLuaConfig = lib.concatStringsSep "\n" [
      "-- { Basic Configurations"
      "-- Generated by home-manager, immutable Configurations."
      (builtins.readFile ./nvim/options.lua)
      (builtins.readFile ./nvim/keymaps.lua)
      (builtins.readFile ./nvim/autocommands.lua)
      "-- } Basic Configurations end\n"
      "-- { Optional extra stuff"
      "-- Defined by user, could be changed without switch then \"nix environment\", may override immutable configurations above."
      "pcall(require, \"extra\")"
      "-- } Optional extra stuff end\n"
      # generate a empty line in the final `init.lua` file
      "\n"
    ];
  };
}
