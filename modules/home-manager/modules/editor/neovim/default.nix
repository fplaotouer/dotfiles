{
  lib,
  config,
  pkgs,
  ...
}: {
  xdg.configFile = {
    "nvim/lua" = {
      source = ./nvim/lua;
      recursive = true;
    };
    "nvim/ftplugin" = {
      source = ./nvim/ftplugin;
      recursive = true;
    };
  };

  programs.neovim = {
    # package = pkgs.neovim-nightly;
    vimAlias = true;
    extraLuaPackages = luaPkgs: with luaPkgs; [luautf8];
    extraPython3Packages = pyPkgs: with pyPkgs; [python-lsp-server rope];
    extraPackages = builtins.attrValues {
      inherit (pkgs) tree-sitter luajit shfmt stylua;
      inherit (pkgs.nodePackages) nodejs;
    };
    extraLuaConfig = lib.concatStringsSep "\n" [
      "-- Configurations generated by home-manager."
      (builtins.readFile ./nvim/lazy.lua)
    ];
  };
}
